openapi: 3.0.0
info:
  title: Fithub API docs
  version: 1.0.0
  description: >
    Fithub API 명세서

servers:
  - url: http://localhost:4000
    description: Local Server

tags:
  - name: Auth
  - name: Project
  - name: Members
  - name: AI Summary
  - name: AI Tasks
  - name: Summaries
  - name: Tasks
  - name: Snapshot
  - name: Repository
  - name: Files
  - name: Commits
  - name: Issues
  - name: Pull Requests

paths:
  /auth/github/login:
    get:
      tags: [Auth]
      summary: GitHub OAuth 로그인
      responses:
        "302":
          description: GitHub 인증 URL로 리다이렉트

  /auth/github/callback:
    get:
      tags: [Auth]
      summary: GitHub OAuth 콜백 → JWT 발급
      parameters:
        - in: query
          name: code
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 로그인 성공, JWT 반환
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"

  /projects:
    post:
      tags: [Project]
      summary: 새 프로젝트 생성 (JWT 필요)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        "200":
          description: 프로젝트 생성 성공
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"

  /projects/{projectId}:
    get:
      tags: [Project]
      summary: 프로젝트 상세 조회 (owner/members/repos/tasks 등)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 프로젝트 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectDetail"

  /projects/{projectId}/repos:
    post:
      tags: [Project]
      summary: 프로젝트에 GitHub repository 연결
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [repo_id]
              properties:
                repo_id:
                  type: integer
      responses:
        "200":
          description: 프로젝트에 repository 추가됨

  /projects/{projectId}/members:
    get:
      tags: [Members]
      summary: 프로젝트 멤버 조회
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 프로젝트 멤버 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProjectMember"

    post:
      tags: [Members]
      summary: 프로젝트에 멤버 추가 (owner만 권한o)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId]
              properties:
                userId:
                  type: integer
      responses:
        "200":
          description: 멤버 추가 성공
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectMember"

  /projects/{projectId}/members/{userId}:
    delete:
      tags: [Members]
      summary: 프로젝트 멤버 삭제 (owner만 권한o)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: integer
        - in: path
          name: userId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 멤버 삭제 성공

  /ai/code-summaries:
    post:
      tags: [AI Summary]
      summary: AI가 생성한 코드 요약 데이터 저장
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [projectId, repo_id, summaryText]
              properties:
                projectId:
                  type: integer
                repo_id:
                  type: integer
                summaryText:
                  type: string
      responses:
        "200":
          description: 요약 저장 성공
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CodeSummary"

  /ai/tasks:
    post:
      tags: [AI Tasks]
      summary: AI가 생성한 task 리스트 저장
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [projectId, tasks]
              properties:
                projectId:
                  type: integer
                tasks:
                  type: array
                  items:
                    type: object
                    properties:
                      title:
                        type: string
                      assigneeId:
                        type: integer
                      status:
                        type: string
      responses:
        "200":
          description: task 저장 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer

  /summaries/{projectId}:
    get:
      tags: [Summaries]
      summary: 프로젝트 내 코드 요약 목록 조회 (멤버만)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 요약 리스트 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CodeSummary"

  /tasks/{projectId}:
    get:
      tags: [Tasks]
      summary: 프로젝트 task 조회 (멤버만)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: task 리스트 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Task"

  /tasks/{taskId}:
    put:
      tags: [Tasks]
      summary: task 상태 변경 (undone/in progress/done)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
      responses:
        "200":
          description: 상태 업데이트 성공
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"

  /api/github/repo-snapshot:
    post:
      tags: [Snapshot]
      summary: GitHub repository snapshot DB에 저장
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                repoFullName:
                  type: string
                  example: "user01/Fithub"
                  description: 'GitHub repo full name ("owner/repo" 형식)'
                branch:
                  type: string
                  example: "main"
                  description: 브랜치 이름 (기본값 main)
                token:
                  type: string
                  description: GitHub Personal Access Token (헤더 Authorization으로 대체 가능)
              required:
                - repoFullName
      responses:
        "200":
          description: 성공적으로 스냅샷 저장됨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SnapshotResult"
        "400":
          description: 잘못된 요청
        "500":
          description: 서버 오류

  /api/github/repos/{repoId}:
    get:
      tags: [Repository]
      summary: 레포지토리 기본 정보 조회
      parameters:
        - in: path
          name: repoId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 레포지토리 정보 반환
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Repository"
        "404":
          description: 레포지토리 없음

  /api/github/repos/{repoId}/files:
    get:
      tags: [Files]
      summary: 파일 목록 조회
      parameters:
        - in: path
          name: repoId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 파일 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/File"

  /api/github/repos/{repoId}/files/tree:
    get:
      tags: [Files]
      summary: 디렉토리 트리 구조로 파일 목록 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 파일 트리 JSON 반환
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /api/github/repos/{repoId}/files/{fileId}:
    get:
      tags: [Files]
      summary: 특정 파일 상세 조회
      parameters:
        - in: path
          name: repoId
          required: true
          schema:
            type: integer
        - in: path
          name: fileId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 파일 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/File"
        "404":
          description: 파일 없음

  /api/github/repos/{repoId}/commits:
    get:
      tags: [Commits]
      summary: 커밋 목록 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: 커밋 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Commit"

  /api/github/repos/{repoId}/commits/{sha}:
    get:
      tags: [Commits]
      summary: 커밋 상세 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema:
            type: integer
        - name: sha
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 커밋 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Commit"
        "404":
          description: 커밋 없음

  /api/github/repos/{repoId}/issues:
    get:
      tags: [Issues]
      summary: Issue 목록 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Issue 리스트 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Issue"

  /api/github/repos/{repoId}/issues/{issueId}:
    get:
      tags: [Issues]
      summary: Issue 상세 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema:
            type: integer
        - name: issueId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Issue 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Issue"
        "404":
          description: Issue 없음

  /api/github/repos/{repoId}/pulls:
    get:
      tags: [Pull Requests]
      summary: Pull Request 목록 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: PR 리스트 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Pull"

  /api/github/repos/{repoId}/pulls/{pullId}:
    get:
      tags: [Pull Requests]
      summary: Pull Request 상세 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema:
            type: integer
        - name: pullId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: PR 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Pull"
        "404":
          description: PR 없음
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    AuthResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: "#/components/schemas/User"

    User:
      type: object
      properties:
        id:
          type: integer
        githubId:
          type: string
        login:
          type: string
        avatarUrl:
          type: string
        name:
          type: string
        email:
          type: string
        createdAt:
          type: string
          format: date-time

    Project:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        ownerId:
          type: integer
        createdAt:
          type: string
          format: date-time

    ProjectMember:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
        projectId:
          type: integer
        user:
          $ref: "#/components/schemas/User"

    ProjectRepository:
      type: object
      properties:
        id:
          type: integer
        projectId:
          type: integer
        repo_id:
          type: integer
        repo:
          $ref: "#/components/schemas/Repository"

    CodeSummary:
      type: object
      properties:
        id:
          type: integer
        projectId:
          type: integer
        repo_id:
          type: integer
        summaryText:
          type: string
        createdAt:
          type: string
          format: date-time

    Task:
      type: object
      properties:
        id:
          type: integer
        projectId:
          type: integer
        title:
          type: string
        assigneeUserId:
          type: integer
        status:
          type: string
        assignee:
          $ref: "#/components/schemas/User"

    Repository:
      type: object
      properties:
        repo_id:
          type: string
        name:
          type: string
        full_name:
          type: string
        description:
          type: string
        language:
          type: string
        created_at:
          type: string
          format: date-time

    File:
      type: object
      properties:
        file_id:
          type: string
        path:
          type: string
        type:
          type: string
        size:
          type: integer
        sha:
          type: string

    Commit:
      type: object
      properties:
        commit_sha:
          type: string
        author_name:
          type: string
        message:
          type: string
        date:
          type: string
          format: date-time

    Issue:
      type: object
      properties:
        issue_id:
          type: integer
        title:
          type: string
        state:
          type: string
        created_at:
          type: string
          format: date-time

    Pull:
      type: object
      properties:
        pull_id:
          type: integer
        title:
          type: string
        state:
          type: string
        created_at:
          type: string
          format: date-time

    SnapshotResult:
      type: object
      properties:
        repo:
          type: string
        commits:
          type: string
        files:
          type: string

    ProjectDetail:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        ownerId:
          type: integer
        owner:
          $ref: "#/components/schemas/User"
        members:
          type: array
          items:
            $ref: "#/components/schemas/ProjectMember"
        repos:
          type: array
          items:
            $ref: "#/components/schemas/ProjectRepository"
        summaries:
          type: array
          items:
            $ref: "#/components/schemas/CodeSummary"
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/Task"
        createdAt:
          type: string
          format: date-time
