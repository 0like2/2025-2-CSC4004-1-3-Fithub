openapi: 3.0.0

info:
  title: Fithub API
  version: 1.0.0
  description: GitHub repository snapshot 저장, 조회 api 명세서

servers:
  - url: http://localhost:4000
    description: Local dev server

tags:
  - name: Snapshot
  - name: Repository
  - name: Files
  - name: Commits
  - name: Issues
  - name: Pull Requests

paths:
  /repo-snapshot:
    post:
      tags: [Snapshot]
      summary: GitHub 레포지토리를 스냅샷하여 DB에 저장
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                owner:
                  type: string
                  example: "naamy"
                repo:
                  type: string
                  example: "Fithub"
              required: [owner, repo]
      responses:
        "200":
          description: 성공적으로 스냅샷 저장됨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SnapshotResult"
        "400":
          description: 잘못된 요청
        "500":
          description: 서버 오류

  /repos/{repoId}:
    get:
      tags: [Repository]
      summary: 레포지토리 기본 정보 조회
      parameters:
        - in: path
          name: repoId
          required: true
          schema:
            type: string
            example: "1234567890123"
      responses:
        "200":
          description: 레포지토리 정보 반환
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Repository"
        "404":
          description: 레포지토리 없음

  /repos/{repoId}/files:
    get:
      tags: [Files]
      summary: 파일 목록 조회
      parameters:
        - in: path
          name: repoId
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 파일 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/File"

  /repos/{repoId}/files/tree:
    get:
      tags: [Files]
      summary: 디렉토리 트리 구조로 파일 목록 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 파일 트리 JSON 반환
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /repos/{repoId}/files/{fileId}:
    get:
      tags: [Files]
      summary: 특정 파일 상세 조회
      parameters:
        - in: path
          name: repoId
          required: true
          schema: { type: string }
        - in: path
          name: fileId
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 파일 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/File"
        "404":
          description: 파일 없음

  /repos/{repoId}/commits:
    get:
      tags: [Commits]
      summary: 커밋 목록 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 커밋 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Commit"

  /repos/{repoId}/commits/{sha}:
    get:
      tags: [Commits]
      summary: 커밋 상세 조회
      parameters:
        - name: repoId
          in: path
          schema: { type: string }
          required: true
        - name: sha
          in: path
          schema: { type: string }
          required: true
      responses:
        "200":
          description: 커밋 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Commit"
        "404":
          description: 커밋 없음

  /repos/{repoId}/issues:
    get:
      tags: [Issues]
      summary: Issue 목록 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Issue 리스트 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Issue"

  /repos/{repoId}/issues/{issueId}:
    get:
      tags: [Issues]
      summary: Issue 상세 조회
      parameters:
        - name: repoId
          in: path
          schema: { type: string }
          required: true
        - name: issueId
          in: path
          schema: { type: integer }
          required: true
      responses:
        "200":
          description: Issue 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Issue"

  /repos/{repoId}/pulls:
    get:
      tags: [Pull Requests]
      summary: Pull Request 목록 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: PR 리스트 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Pull"

  /repos/{repoId}/pulls/{pullId}:
    get:
      tags: [Pull Requests]
      summary: Pull Request 상세 조회
      parameters:
        - name: repoId
          in: path
          required: true
          schema: { type: string }
        - name: pullId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: PR 상세 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Pull"
        "404":
          description: PR 없음

components:
  schemas:
    Repository:
      type: object
      properties:
        repo_id: { type: string }
        name: { type: string }
        full_name: { type: string }
        description: { type: string }
        language: { type: string }
        created_at: { type: string, format: date-time }

    File:
      type: object
      properties:
        file_id: { type: string }
        path: { type: string }
        type: { type: string }
        size: { type: integer }
        sha: { type: string }

    Commit:
      type: object
      properties:
        commit_sha: { type: string }
        author_name: { type: string }
        message: { type: string }
        date: { type: string, format: date-time }

    Issue:
      type: object
      properties:
        issue_id: { type: integer }
        title: { type: string }
        state: { type: string }
        created_at: { type: string, format: date-time }

    Pull:
      type: object
      properties:
        pull_id: { type: integer }
        title: { type: string }
        state: { type: string }
        created_at: { type: string, format: date-time }

    SnapshotResult:
      type: object
      properties:
        repo:
          type: string
          example: "saved"
        commits:
          type: string
          example: "saved"
        files:
          type: string
          example: "saved"
